{
    "cells": [
        {
            "language": "shellscript",
            "source": [
                "# Uncomment below to install dependencies if needed.\n# yarn add data-forge\n# yarn add data-forge-fs"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "# CSV to JSON view model\n\nUsing [data-forge](https://www.data-forge-js.com) to transform csv file from Athena query results into a usable JSON object. From there we can inject the JSON object into a template to render out all our emails."
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const dataForge = require('data-forge');\nconst fs = require('fs');\nrequire('data-forge-fs');\n\nconst queryResults = fs.readFileSync('data/test-query-results.csv', 'utf-8')"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "## Algorithm\n\nWe want to create a data structure from this CSV file that we can pass into an email template to render it. This means it should ultimately be JSON, so the template renderer can parse it out. The structure should be similar to the following..."
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "In order to accomplish this, we'd need to use dataforge to.\n\n1. Group by recipient, record recipient\n2. Group by program, record program\n3. Group by resident.\n4. Group by procedures."
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const { formatReportData } = require('../dataFormatting');\n\nvar all_emails = formatReportData(queryResults);\nconsole.log(\"total recipients: \", all_emails.length);\nconsole.log(\"all data\", JSON.stringify(all_emails, null, 2));\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "total recipients:  28",
                                " \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/f06dfd8051230d3bdf7ebd2ea5b8b32f\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Peripheral Arterial Puncture\",",
                                "                \"procedure_id\": \"37677bab-4c50-4cba-99b4-988c648fc5f9\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 0",
                                "              }",
                                "            ]",
                                "          },",
                                "          {",
                                "            \"trainee_firstname\": \"Marcus\",",
                                "            \"trainee_lastname\": \"Threadcraft\",",
                                "            \"trainee_email\": \"marcus.threadcraft@vumc.org\",",
                                "            \"trainee_id\": \"0c66a820-abbc-4b9c-b039-4aa572dbac4d\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/0c66a820-abbc-4b9c-b039-4aa572dbac4d\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Internal Jugular Central Line Placement (Ultrasound-Guided)\",",
                                "                \"procedure_id\": \"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              },",
                                "              {",
                                "                \"procedure_name\": \"Radial Arterial Line Placement\",",
                                "                \"procedure_id\": \"b93afc31-7357-4995-8fdd-2fe9aae853bb\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              }",
                                "            ]",
                                "          }",
                                "        ]",
                                "      }",
                                "    ]",
                                "  },",
                                "  {",
                                "    \"recipient_email\": \"neeraja.peterson@vumc.org\",",
                                "    \"recipient_firstname\": \"Neeraja\",",
                                "    \"recipient_lastname\": \"Peterson\",",
                                "    \"program_name\": \"Internal Medicine\",",
                                "    \"total_evals\": 5,",
                                "    \"one_week_ago\": \"3/29/2022\",",
                                "    \"programs\": [",
                                "      {",
                                "        \"program_name\": \"Internal Medicine\",",
                                "        \"trainees\": [",
                                "          {",
                                "            \"trainee_firstname\": \"Kate\",",
                                "            \"trainee_lastname\": \"Heckman\",",
                                "            \"trainee_email\": \"katherine.heckman@vumc.org\",",
                                "            \"trainee_id\": \"f41ce33561e4b5c13ef4076c955d6598\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/f41ce33561e4b5c13ef4076c955d6598\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Femoral Central Line Placement\",",
                                "                \"procedure_id\": \"3b085f91-07c6-4277-8a7b-a5ff6c9701b6\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 0",
                                "              },",
                                "              {",
                                "                \"procedure_name\": \"Placement of Pulmonary Artery Catheter\",",
                                "                \"procedure_id\": \"2d103229-a1fa-4560-a84d-0a2616fcd349\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 0",
                                "              }",
                                "            ]",
                                "          },",
                                "          {",
                                "            \"trainee_firstname\": \"Jamie\",",
                                "            \"trainee_lastname\": \"Pfaff\",",
                                "            \"trainee_email\": \"jamie.pfaff@vumc.org\",",
                                "            \"trainee_id\": \"f06dfd8051230d3bdf7ebd2ea5b8b32f\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/f06dfd8051230d3bdf7ebd2ea5b8b32f\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Peripheral Arterial Puncture\",",
                                "                \"procedure_id\": \"37677bab-4c50-4cba-99b4-988c648fc5f9\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 0",
                                "              }",
                                "            ]",
                                "          },",
                                "          {",
                                "            \"trainee_firstname\": \"Marcus\",",
                                "            \"trainee_lastname\": \"Threadcraft\",",
                                "            \"trainee_email\": \"marcus.threadcraft@vumc.org\",",
                                "            \"trainee_id\": \"0c66a820-abbc-4b9c-b039-4aa572dbac4d\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/0c66a820-abbc-4b9c-b039-4aa572dbac4d\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Internal Jugular Central Line Placement (Ultrasound-Guided)\",",
                                "                \"procedure_id\": \"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              },",
                                "              {",
                                "                \"procedure_name\": \"Radial Arterial Line Placement\",",
                                "                \"procedure_id\": \"b93afc31-7357-4995-8fdd-2fe9aae853bb\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              }",
                                "            ]",
                                "          }",
                                "        ]",
                                "      }",
                                "    ]",
                                "  },",
                                "  {",
                                "    \"recipient_email\": \"christopher.lee@vumc.org\",",
                                "    \"recipient_firstname\": \"Christopher\",",
                                "    \"recipient_lastname\": \"Lee\",",
                                "    \"program_name\": \"Neurology\",",
                                "    \"total_evals\": 1,",
                                "    \"one_week_ago\": \"3/29/2022\",",
                                "    \"programs\": [",
                                "      {",
                                "        \"program_name\": \"Neurology\",",
                                "        \"trainees\": [",
                                "          {",
                                "            \"trainee_firstname\": \"Tamer\",",
                                "            \"trainee_lastname\": \"Ghanayem\",",
                                "            \"trainee_email\": \"tamer.ghanayem@vumc.org\",",
                                "            \"trainee_id\": \"b199795f-e793-43f0-bcb2-547409b662ba\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/b199795f-e793-43f0-bcb2-547409b662ba\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Lumbar Puncture\",",
                                "                \"procedure_id\": \"d0c4cdac-0747-4996-a819-76b0728f621b\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              }",
                                "            ]",
                                "          }",
                                "        ]",
                                "      }",
                                "    ]",
                                "  },",
                                "  {",
                                "    \"recipient_email\": \"heather.koons@vumc.org\",",
                                "    \"recipient_firstname\": \"Heather\",",
                                "    \"recipient_lastname\": \"Koons\",",
                                "    \"program_name\": \"Neurology\",",
                                "    \"total_evals\": 1,",
                                "    \"one_week_ago\": \"3/29/2022\",",
                                "    \"programs\": [",
                                "      {",
                                "        \"program_name\": \"Neurology\",",
                                "        \"trainees\": [",
                                "          {",
                                "            \"trainee_firstname\": \"Tamer\",",
                                "            \"trainee_lastname\": \"Ghanayem\",",
                                "            \"trainee_email\": \"tamer.ghanayem@vumc.org\",",
                                "            \"trainee_id\": \"b199795f-e793-43f0-bcb2-547409b662ba\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/b199795f-e793-43f0-bcb2-547409b662ba\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Lumbar Puncture\",",
                                "                \"procedure_id\": \"d0c4cdac-0747-4996-a819-76b0728f621b\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              }",
                                "            ]",
                                "          }",
                                "        ]",
                                "      }",
                                "    ]",
                                "  },",
                                "  {",
                                "    \"recipient_email\": \"reena.j.black@vumc.org\",",
                                "    \"recipient_firstname\": \"Reena\",",
                                "    \"recipient_lastname\": \"Black\",",
                                "    \"program_name\": \"Neurology\",",
                                "    \"total_evals\": 1,",
                                "    \"one_week_ago\": \"3/29/2022\",",
                                "    \"programs\": [",
                                "      {",
                                "        \"program_name\": \"Neurology\",",
                                "        \"trainees\": [",
                                "          {",
                                "            \"trainee_firstname\": \"Tamer\",",
                                "            \"trainee_lastname\": \"Ghanayem\",",
                                "            \"trainee_email\": \"tamer.ghanayem@vumc.org\",",
                                "            \"trainee_id\": \"b199795f-e793-43f0-bcb2-547409b662ba\",",
                                "            \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/b199795f-e793-43f0-bcb2-547409b662ba\",",
                                "            \"procedures\": [",
                                "              {",
                                "                \"procedure_name\": \"Lumbar Puncture\",",
                                "                \"procedure_id\": \"d0c4cdac-0747-4996-a819-76b0728f621b\",",
                                "                \"total_procs\": 1,",
                                "                \"practice_ready_procs\": 1",
                                "              }",
                                "            ]",
                                "          }",
                                "        ]",
                                "      }",
                                "    ]",
                                "  }",
                                "]",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "javascript",
            "source": [
                "let output = JSON.stringify(all_emails);\nfs.writeFileSync('data/emails.json', output)\nconsole.log(\"json output:\", JSON.stringify(all_emails[1], null, 2))"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "json output: {",
                                "  \"recipient_email\": \"elisabeth.hudson@vumc.org\",",
                                "  \"recipient_firstname\": \"Elisabeth\",",
                                "  \"recipient_lastname\": \"Hudson\",",
                                "  \"program_name\": \"Anesthesiology\",",
                                "  \"total_evals\": 1,",
                                "  \"one_week_ago\": \"3/29/2022\",",
                                "  \"programs\": [",
                                "    {",
                                "      \"program_name\": \"Anesthesiology\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Ellen\",",
                                "          \"trainee_lastname\": \"Stallings\",",
                                "          \"trainee_email\": \"ellen.stallings@vumc.org\",",
                                "          \"trainee_id\": \"d7305866e20ed90cade9aae153ac8a6f\",",
                                "          \"trainee_url\": \"https://andy.d1i7ckh5uj1s23.amplifyapp.com/user/d7305866e20ed90cade9aae153ac8a6f\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Subclavian Central Line Placement\",",
                                "              \"procedure_id\": \"9553f162-6078-4c3e-8ca2-67c2078196ca\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  ]",
                                "}",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "## Rendering Emails\n\nThe AWS SES service supports rendering bulk emails using handlebars templates\n\n- https://aws.amazon.com/blogs/messaging-and-targeting/introducing-email-templates-and-bulk-sending/\n- https://docs.aws.amazon.com/ses/latest/dg/send-personalized-email-advanced.html"
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const handlebars = require('handlebars')\nvar template = handlebars.compile(\"<html><head></head><body>Handlebars <b>{{doesWhat}}</b></body>\");\ntemplate({ doesWhat: \"rocks!\" });\n\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "text/plain",
                            "value": [
                                "\u001b[32m'<html><head></head><body>Handlebars <b>rocks!</b></body>'\u001b[39m"
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "javascript",
            "source": [
                "var pluralize = handlebars.compile(\"<p>{{#if eval_count }} evaluations {{/if}}</p>\")\ntry {\n  var rendered = pluralize({eval_count: 0});  \n  console.log(rendered)\n} catch (error) {\n  console.log(error)\n}\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "<p></p>",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "### Reports Template\n\nThe following code snippet will render the program admin report template with the parsed data structure above, and produce a fully rendered prototype of the data in the 'rendered.html' file in the data folder. In production, AWS will render this for us using the handlebars "
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const report_template = fs.readFileSync('../templates/program-admin-report.html', 'utf8')\ntry {\n  const report_compiled = handlebars.compile(report_template)\n  const report_rendered = report_compiled(all_emails[8])\n  fs.writeFileSync('data/rendered.html', report_rendered);\n} catch (error) {\n  console.log(error)\n}\n\n"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "## AWS SES, Bulk Email, and Templates\n\nThe api call to create an SES email template requires the following JSON file."
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "\nconst sesTemplate = {\n  \"Template\": {\n    \"TemplateName\": \"TestTemplate\",\n    \"SubjectPart\": \"New SIMPL Bedside evaluations of your trainee\",\n    \"TextPart\": \"updated\",\n    \"HtmlPart\": `${report_template}`\n  }\n}\ntry {\n  fs.writeFileSync('data/program-admin-report.json', JSON.stringify(sesTemplate))  \n} catch (error) {\n  console.log(error)\n}\n\n"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "The CLI commands to create and update the template are as follows..."
            ],
            "outputs": []
        },
        {
            "language": "shellscript",
            "source": [
                "# aws ses create-template --cli-input-json file://./templates/program-admin-report.json --profile bedside\n# aws ses update-template --cli-input-json file://./templates/program-admin-report.json --profile bedside"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stderr",
                            "value": [
                                "/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/OpenSSL/crypto.py:14: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.",
                                "  from cryptography import utils, x509",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "### Send a single email with the template\nIn order to send the email, we need to create another JSON object with the data, and pass the email data as part of the call."
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const sendOne = {\n  Source : \"admin@simpl-bedside.org\",\n  Template : \"TestTemplate\",\n  Destination : {\n    ToAddresses : [ \"andy@simpl.org\" ]\n  },\n  TemplateData : JSON.stringify(all_emails[0])\n}\n\ntry {\n  fs.writeFileSync('data/single-email.json', JSON.stringify(sendOne))  \n} catch (error) {\n  console.log(error)\n}"
            ],
            "outputs": []
        },
        {
            "language": "shellscript",
            "source": [
                "aws ses send-templated-email --cli-input-json file://./templates/single-email.json --profile bedside"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "## Bulk Sending\nOur ability to send bulk templated emails is determined by our account settings and AWS Quotas. See [Service Quotas in Amazon SES](https://docs.aws.amazon.com/ses/latest/dg/quotas.html)\n"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "## Using the javascript library to send an email"
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const AWS = require(\"aws-sdk\");\n// Only required for running locally.\nvar credentials = new AWS.SharedIniFileCredentials({profile: 'bedside'});\nAWS.config.credentials = credentials;\n\n//\nconst ses = new AWS.SES();\nawait ses.sendTemplatedEmail(sendOne, (err) => {\n  console.log(err)\n})"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "text/plain",
                            "value": [
                                "\u001b[36m<ref *1>\u001b[39m Request {",
                                "  domain: \u001b[1mnull\u001b[22m,",
                                "  service: Service {",
                                "    config: Config {",
                                "      credentials: \u001b[36m[SharedIniFileCredentials]\u001b[39m,",
                                "      credentialProvider: \u001b[36m[CredentialProviderChain]\u001b[39m,",
                                "      region: \u001b[32m'us-east-1'\u001b[39m,",
                                "      logger: \u001b[1mnull\u001b[22m,",
                                "      apiVersions: {},",
                                "      apiVersion: \u001b[1mnull\u001b[22m,",
                                "      endpoint: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      httpOptions: \u001b[36m[Object]\u001b[39m,",
                                "      maxRetries: \u001b[90mundefined\u001b[39m,",
                                "      maxRedirects: \u001b[33m10\u001b[39m,",
                                "      paramValidation: \u001b[33mtrue\u001b[39m,",
                                "      sslEnabled: \u001b[33mtrue\u001b[39m,",
                                "      s3ForcePathStyle: \u001b[33mfalse\u001b[39m,",
                                "      s3BucketEndpoint: \u001b[33mfalse\u001b[39m,",
                                "      s3DisableBodySigning: \u001b[33mtrue\u001b[39m,",
                                "      s3UsEast1RegionalEndpoint: \u001b[32m'legacy'\u001b[39m,",
                                "      s3UseArnRegion: \u001b[90mundefined\u001b[39m,",
                                "      computeChecksums: \u001b[33mtrue\u001b[39m,",
                                "      convertResponseTypes: \u001b[33mtrue\u001b[39m,",
                                "      correctClockSkew: \u001b[33mfalse\u001b[39m,",
                                "      customUserAgent: \u001b[1mnull\u001b[22m,",
                                "      dynamoDbCrc32: \u001b[33mtrue\u001b[39m,",
                                "      systemClockOffset: \u001b[33m0\u001b[39m,",
                                "      signatureVersion: \u001b[32m'v4'\u001b[39m,",
                                "      signatureCache: \u001b[33mtrue\u001b[39m,",
                                "      retryDelayOptions: {},",
                                "      useAccelerateEndpoint: \u001b[33mfalse\u001b[39m,",
                                "      clientSideMonitoring: \u001b[33mfalse\u001b[39m,",
                                "      endpointDiscoveryEnabled: \u001b[90mundefined\u001b[39m,",
                                "      endpointCacheSize: \u001b[33m1000\u001b[39m,",
                                "      hostPrefixEnabled: \u001b[33mtrue\u001b[39m,",
                                "      stsRegionalEndpoints: \u001b[32m'legacy'\u001b[39m,",
                                "      useFipsEndpoint: \u001b[33mfalse\u001b[39m,",
                                "      useDualstackEndpoint: \u001b[33mfalse\u001b[39m",
                                "    },",
                                "    isGlobalEndpoint: \u001b[33mfalse\u001b[39m,",
                                "    endpoint: Endpoint {",
                                "      protocol: \u001b[32m'https:'\u001b[39m,",
                                "      host: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      port: \u001b[33m443\u001b[39m,",
                                "      hostname: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      pathname: \u001b[32m'/'\u001b[39m,",
                                "      path: \u001b[32m'/'\u001b[39m,",
                                "      href: \u001b[32m'https://email.us-east-1.amazonaws.com/'\u001b[39m",
                                "    },",
                                "    _events: {",
                                "      apiCallAttempt: \u001b[36m[Array]\u001b[39m,",
                                "      apiCall: \u001b[36m[Array]\u001b[39m",
                                "    },",
                                "    MONITOR_EVENTS_BUBBLE: \u001b[36m[Function: EVENTS_BUBBLE]\u001b[39m,",
                                "    CALL_EVENTS_BUBBLE: \u001b[36m[Function: CALL_EVENTS_BUBBLE]\u001b[39m,",
                                "    _clientId: \u001b[33m1\u001b[39m",
                                "  },",
                                "  operation: \u001b[32m'sendTemplatedEmail'\u001b[39m,",
                                "  params: {",
                                "    Source: \u001b[32m'admin@simpl-bedside.org'\u001b[39m,",
                                "    Template: \u001b[32m'TestTemplate'\u001b[39m,",
                                "    Destination: {",
                                "      ToAddresses: \u001b[36m[Array]\u001b[39m",
                                "    },",
                                "    TemplateData: \u001b[32m'{\"recipient_email\":\"matthew.pirotte@vumc.org\",\"recipient_firstname\":\"Matthew\",\"recipient_lastname\":\"Pirotte\",\"program_name\":\"Emergency Medicine\",\"total_evals\":6,\"two_weeks_ago\":\"2/28/2022\",\"trainees\":[{\"trainee_firstname\":\"Amanda\",\"trainee_lastname\":\"Whipple\",\"trainee_email\":\"amanda.barrett@vumc.org\",\"trainee_id\":\"8029a70e2d6814e2cc6c956f661d53bc\",\"trainee_program\":\"Emergency Medicine\",\"procedures\":[{\"procedure_name\":\"Endotracheal Intubation\",\"procedure_id\":\"6938c24a-c8f5-4cb3-a5e1-61e0a3a174f9\",\"total_procs\":1,\"practice_ready_procs\":1},{\"procedure_name\":\"Femoral Arterial Catheter Placement\",\"procedure_id\":\"b2c5d1d7-69fc-4019-8a91-dff9538ddd7f\",\"total_procs\":1,\"practice_ready_procs\":1},{\"procedure_name\":\"Femoral Central Line Placement\",\"procedure_id\":\"3b085f91-07c6-4277-8a7b-a5ff6c9701b6\",\"total_procs\":1,\"practice_ready_procs\":1}]},{\"trainee_firstname\":\"Austin\",\"trainee_lastname\":\"Tipold\",\"trainee_email\":\"austin.tipold@vumc.org\",\"trainee_id\":\"d6070acf-6632-423f-82ac-6453c1068fef\",\"trainee_program\":\"Emergency Medicine\",\"procedures\":[{\"procedure_name\":\"Conscious Sedation\",\"procedure_id\":\"979c680b-3ad4-4890-b584-c12e104ce00a\",\"total_procs\":1,\"practice_ready_procs\":0}]},{\"trainee_firstname\":\"Katherine\",\"trainee_lastname\":\"Rief\",\"trainee_email\":\"katherine.rief@vumc.org\",\"trainee_id\":\"be4975b7-d38c-483b-a2ba-58a0af013ea5\",\"trainee_program\":\"Emergency Medicine\",\"procedures\":[{\"procedure_name\":\"Internal Jugular Central Line Placement (Ultrasound-Guided)\",\"procedure_id\":\"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",\"total_procs\":1,\"practice_ready_procs\":1},{\"procedure_name\":\"Radial Arterial Line Placement\",\"procedure_id\":\"b93afc31-7357-4995-8fdd-2fe9aae853bb\",\"total_procs\":1,\"practice_ready_procs\":1}]}]}'\u001b[39m",
                                "  },",
                                "  httpRequest: HttpRequest {",
                                "    method: \u001b[32m'POST'\u001b[39m,",
                                "    path: \u001b[32m'/'\u001b[39m,",
                                "    headers: {",
                                "      \u001b[32m'User-Agent'\u001b[39m: \u001b[32m'aws-sdk-nodejs/2.1073.0 darwin/v14.17.6 callback'\u001b[39m,",
                                "      \u001b[32m'Content-Type'\u001b[39m: \u001b[32m'application/x-www-form-urlencoded; charset=utf-8'\u001b[39m,",
                                "      \u001b[32m'X-Amz-Content-Sha256'\u001b[39m: \u001b[32m'94bc5cd17ad07ca42ec7de05c3207ed8ee7856d84aa010320664593f08896d31'\u001b[39m,",
                                "      \u001b[32m'Content-Length'\u001b[39m: \u001b[33m2502\u001b[39m,",
                                "      Host: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      \u001b[32m'X-Amz-Date'\u001b[39m: \u001b[32m'20220314T142852Z'\u001b[39m,",
                                "      Authorization: \u001b[32m'AWS4-HMAC-SHA256 Credential=AKIAYWH62BOMSDYA5UXX/20220314/us-east-1/ses/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=46d64024c93de3ba7674a68c1dc5e6fc0c514f417e93d359c1d1f0bba22d4e1f'\u001b[39m",
                                "    },",
                                "    body: \u001b[32m'Action=SendTemplatedEmail&Destination.ToAddresses.member.1=andy%40simpl.org&Source=admin%40simpl-bedside.org&Template=TestTemplate&TemplateData=%7B%22recipient_email%22%3A%22matthew.pirotte%40vumc.org%22%2C%22recipient_firstname%22%3A%22Matthew%22%2C%22recipient_lastname%22%3A%22Pirotte%22%2C%22program_name%22%3A%22Emergency%20Medicine%22%2C%22total_evals%22%3A6%2C%22two_weeks_ago%22%3A%222%2F28%2F2022%22%2C%22trainees%22%3A%5B%7B%22trainee_firstname%22%3A%22Amanda%22%2C%22trainee_lastname%22%3A%22Whipple%22%2C%22trainee_email%22%3A%22amanda.barrett%40vumc.org%22%2C%22trainee_id%22%3A%228029a70e2d6814e2cc6c956f661d53bc%22%2C%22trainee_program%22%3A%22Emergency%20Medicine%22%2C%22procedures%22%3A%5B%7B%22procedure_name%22%3A%22Endotracheal%20Intubation%22%2C%22procedure_id%22%3A%226938c24a-c8f5-4cb3-a5e1-61e0a3a174f9%22%2C%22total_procs%22%3A1%2C%22practice_ready_procs%22%3A1%7D%2C%7B%22procedure_name%22%3A%22Femoral%20Arterial%20Catheter%20Placement%22%2C%22procedure_id%22%3A%22b2c5d1d7-69fc-4019-8a91-dff9538ddd7f%22%2C%22total_procs%22%3A1%2C%22practice_ready_procs%22%3A1%7D%2C%7B%22procedure_name%22%3A%22Femoral%20Central%20Line%20Placement%22%2C%22procedure_id%22%3A%223b085f91-07c6-4277-8a7b-a5ff6c9701b6%22%2C%22total_procs%22%3A1%2C%22practice_ready_procs%22%3A1%7D%5D%7D%2C%7B%22trainee_firstname%22%3A%22Austin%22%2C%22trainee_lastname%22%3A%22Tipold%22%2C%22trainee_email%22%3A%22austin.tipold%40vumc.org%22%2C%22trainee_id%22%3A%22d6070acf-6632-423f-82ac-6453c1068fef%22%2C%22trainee_program%22%3A%22Emergency%20Medicine%22%2C%22procedures%22%3A%5B%7B%22procedure_name%22%3A%22Conscious%20Sedation%22%2C%22procedure_id%22%3A%22979c680b-3ad4-4890-b584-c12e104ce00a%22%2C%22total_procs%22%3A1%2C%22practice_ready_procs%22%3A0%7D%5D%7D%2C%7B%22trainee_firstname%22%3A%22Katherine%22%2C%22trainee_lastname%22%3A%22Rief%22%2C%22trainee_email%22%3A%22katherine.rief%40vumc.org%22%2C%22trainee_id%22%3A%22be4975b7-d38c-483b-a2ba-58a0af013ea5%22%2C%22trainee_program%22%3A%22Emergency%20Medicine%22%2C%22procedures%22%3A%5B%7B%22procedure_name%22%3A%22Internal%20Jugular%20Central%20Line%20Placement%20%28Ultrasound-Guided%29%22%2C%22procedure_id%22%3A%2273d7dc13-83c6-4ff6-8022-35a3c55a4a95%22%2C%22total_procs%22%3A1%2C%22practice_ready_procs%22%3A1%7D%2C%7B%22procedure_name%22%3A%22Radial%20Arterial%20Line%20Placement%22%2C%22procedure_id%22%3A%22b93afc31-7357-4995-8fdd-2fe9aae853bb%22%2C%22total_procs%22%3A1%2C%22practice_ready_procs%22%3A1%7D%5D%7D%5D%7D&Version=2010-12-01'\u001b[39m,",
                                "    endpoint: {",
                                "      protocol: \u001b[32m'https:'\u001b[39m,",
                                "      host: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      port: \u001b[33m443\u001b[39m,",
                                "      hostname: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      pathname: \u001b[32m'/'\u001b[39m,",
                                "      path: \u001b[32m'/'\u001b[39m,",
                                "      href: \u001b[32m'https://email.us-east-1.amazonaws.com/'\u001b[39m,",
                                "      constructor: \u001b[36m[Function]\u001b[39m",
                                "    },",
                                "    region: \u001b[32m'us-east-1'\u001b[39m,",
                                "    _userAgent: \u001b[32m'aws-sdk-nodejs/2.1073.0 darwin/v14.17.6 callback'\u001b[39m,",
                                "    params: {",
                                "      Version: \u001b[32m'2010-12-01'\u001b[39m,",
                                "      Action: \u001b[32m'SendTemplatedEmail'\u001b[39m,",
                                "      Source: \u001b[32m'admin@simpl-bedside.org'\u001b[39m,",
                                "      \u001b[32m'Destination.ToAddresses.member.1'\u001b[39m: \u001b[32m'andy@simpl.org'\u001b[39m,",
                                "      Template: \u001b[32m'TestTemplate'\u001b[39m,",
                                "      TemplateData: \u001b[32m'{\"recipient_email\":\"matthew.pirotte@vumc.org\",\"recipient_firstname\":\"Matthew\",\"recipient_lastname\":\"Pirotte\",\"program_name\":\"Emergency Medicine\",\"total_evals\":6,\"two_weeks_ago\":\"2/28/2022\",\"trainees\":[{\"trainee_firstname\":\"Amanda\",\"trainee_lastname\":\"Whipple\",\"trainee_email\":\"amanda.barrett@vumc.org\",\"trainee_id\":\"8029a70e2d6814e2cc6c956f661d53bc\",\"trainee_program\":\"Emergency Medicine\",\"procedures\":[{\"procedure_name\":\"Endotracheal Intubation\",\"procedure_id\":\"6938c24a-c8f5-4cb3-a5e1-61e0a3a174f9\",\"total_procs\":1,\"practice_ready_procs\":1},{\"procedure_name\":\"Femoral Arterial Catheter Placement\",\"procedure_id\":\"b2c5d1d7-69fc-4019-8a91-dff9538ddd7f\",\"total_procs\":1,\"practice_ready_procs\":1},{\"procedure_name\":\"Femoral Central Line Placement\",\"procedure_id\":\"3b085f91-07c6-4277-8a7b-a5ff6c9701b6\",\"total_procs\":1,\"practice_ready_procs\":1}]},{\"trainee_firstname\":\"Austin\",\"trainee_lastname\":\"Tipold\",\"trainee_email\":\"austin.tipold@vumc.org\",\"trainee_id\":\"d6070acf-6632-423f-82ac-6453c1068fef\",\"trainee_program\":\"Emergency Medicine\",\"procedures\":[{\"procedure_name\":\"Conscious Sedation\",\"procedure_id\":\"979c680b-3ad4-4890-b584-c12e104ce00a\",\"total_procs\":1,\"practice_ready_procs\":0}]},{\"trainee_firstname\":\"Katherine\",\"trainee_lastname\":\"Rief\",\"trainee_email\":\"katherine.rief@vumc.org\",\"trainee_id\":\"be4975b7-d38c-483b-a2ba-58a0af013ea5\",\"trainee_program\":\"Emergency Medicine\",\"procedures\":[{\"procedure_name\":\"Internal Jugular Central Line Placement (Ultrasound-Guided)\",\"procedure_id\":\"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",\"total_procs\":1,\"practice_ready_procs\":1},{\"procedure_name\":\"Radial Arterial Line Placement\",\"procedure_id\":\"b93afc31-7357-4995-8fdd-2fe9aae853bb\",\"total_procs\":1,\"practice_ready_procs\":1}]}]}'\u001b[39m",
                                "    },",
                                "    stream: ClientRequest {",
                                "      _events: \u001b[36m[Object: null prototype]\u001b[39m,",
                                "      _eventsCount: \u001b[33m7\u001b[39m,",
                                "      _maxListeners: \u001b[90mundefined\u001b[39m,",
                                "      outputData: [],",
                                "      outputSize: \u001b[33m0\u001b[39m,",
                                "      writable: \u001b[33mtrue\u001b[39m,",
                                "      destroyed: \u001b[33mfalse\u001b[39m,",
                                "      _last: \u001b[33mfalse\u001b[39m,",
                                "      chunkedEncoding: \u001b[33mfalse\u001b[39m,",
                                "      shouldKeepAlive: \u001b[33mtrue\u001b[39m,",
                                "      _defaultKeepAlive: \u001b[33mtrue\u001b[39m,",
                                "      useChunkedEncodingByDefault: \u001b[33mtrue\u001b[39m,",
                                "      sendDate: \u001b[33mfalse\u001b[39m,",
                                "      _removedConnection: \u001b[33mfalse\u001b[39m,",
                                "      _removedContLen: \u001b[33mfalse\u001b[39m,",
                                "      _removedTE: \u001b[33mfalse\u001b[39m,",
                                "      _contentLength: \u001b[33m2502\u001b[39m,",
                                "      _hasBody: \u001b[33mtrue\u001b[39m,",
                                "      _trailer: \u001b[32m''\u001b[39m,",
                                "      finished: \u001b[33mtrue\u001b[39m,",
                                "      _headerSent: \u001b[33mtrue\u001b[39m,",
                                "      socket: \u001b[36m[TLSSocket]\u001b[39m,",
                                "      _header: \u001b[32m'POST / HTTP/1.1\\r\\n'\u001b[39m +",
                                "        \u001b[32m'User-Agent: aws-sdk-nodejs/2.1073.0 darwin/v14.17.6 callback\\r\\n'\u001b[39m +",
                                "        \u001b[32m'Content-Type: application/x-www-form-urlencoded; charset=utf-8\\r\\n'\u001b[39m +",
                                "        \u001b[32m'X-Amz-Content-Sha256: 94bc5cd17ad07ca42ec7de05c3207ed8ee7856d84aa010320664593f08896d31\\r\\n'\u001b[39m +",
                                "        \u001b[32m'Content-Length: 2502\\r\\n'\u001b[39m +",
                                "        \u001b[32m'Host: email.us-east-1.amazonaws.com\\r\\n'\u001b[39m +",
                                "        \u001b[32m'X-Amz-Date: 20220314T142852Z\\r\\n'\u001b[39m +",
                                "        \u001b[32m'Authorization: AWS4-HMAC-SHA256 Credential=AKIAYWH62BOMSDYA5UXX/20220314/us-east-1/ses/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=46d64024c93de3ba7674a68c1dc5e6fc0c514f417e93d359c1d1f0bba22d4e1f\\r\\n'\u001b[39m +",
                                "        \u001b[32m'Connection: keep-alive\\r\\n'\u001b[39m +",
                                "        \u001b[32m'\\r\\n'\u001b[39m,",
                                "      _keepAliveTimeout: \u001b[33m0\u001b[39m,",
                                "      _onPendingData: \u001b[36m[Function: noopPendingOutput]\u001b[39m,",
                                "      agent: \u001b[36m[Agent]\u001b[39m,",
                                "      socketPath: \u001b[90mundefined\u001b[39m,",
                                "      method: \u001b[32m'POST'\u001b[39m,",
                                "      maxHeaderSize: \u001b[90mundefined\u001b[39m,",
                                "      insecureHTTPParser: \u001b[90mundefined\u001b[39m,",
                                "      path: \u001b[32m'/'\u001b[39m,",
                                "      _ended: \u001b[33mfalse\u001b[39m,",
                                "      res: \u001b[1mnull\u001b[22m,",
                                "      aborted: \u001b[33mfalse\u001b[39m,",
                                "      timeoutCb: \u001b[36m[Function: emitRequestTimeout]\u001b[39m,",
                                "      upgradeOrConnect: \u001b[33mfalse\u001b[39m,",
                                "      parser: \u001b[36m[HTTPParser]\u001b[39m,",
                                "      maxHeadersCount: \u001b[1mnull\u001b[22m,",
                                "      reusedSocket: \u001b[33mfalse\u001b[39m,",
                                "      host: \u001b[32m'email.us-east-1.amazonaws.com'\u001b[39m,",
                                "      protocol: \u001b[32m'https:'\u001b[39m,",
                                "      didCallback: \u001b[33mfalse\u001b[39m,",
                                "      [\u001b[32mSymbol(kCapture)\u001b[39m]: \u001b[33mfalse\u001b[39m,",
                                "      [\u001b[32mSymbol(kNeedDrain)\u001b[39m]: \u001b[33mfalse\u001b[39m,",
                                "      [\u001b[32mSymbol(corked)\u001b[39m]: \u001b[33m0\u001b[39m,",
                                "      [\u001b[32mSymbol(kOutHeaders)\u001b[39m]: \u001b[36m[Object: null prototype]\u001b[39m",
                                "    }",
                                "  },",
                                "  startTime: \u001b[35m2022-03-14T14:28:52.062Z\u001b[39m,",
                                "  response: Response {",
                                "    request: \u001b[36m[Circular *1]\u001b[39m,",
                                "    data: \u001b[1mnull\u001b[22m,",
                                "    error: \u001b[1mnull\u001b[22m,",
                                "    retryCount: \u001b[33m0\u001b[39m,",
                                "    redirectCount: \u001b[33m0\u001b[39m,",
                                "    httpResponse: HttpResponse {",
                                "      statusCode: \u001b[90mundefined\u001b[39m,",
                                "      headers: {},",
                                "      body: \u001b[90mundefined\u001b[39m,",
                                "      streaming: \u001b[33mfalse\u001b[39m,",
                                "      stream: \u001b[1mnull\u001b[22m,",
                                "      _abortCallback: \u001b[36m[Function: callNextListener]\u001b[39m",
                                "    },",
                                "    maxRetries: \u001b[33m3\u001b[39m,",
                                "    maxRedirects: \u001b[33m10\u001b[39m",
                                "  },",
                                "  _asm: AcceptorStateMachine {",
                                "    currentState: \u001b[32m'send'\u001b[39m,",
                                "    states: {",
                                "      validate: \u001b[36m[Object]\u001b[39m,",
                                "      build: \u001b[36m[Object]\u001b[39m,",
                                "      afterBuild: \u001b[36m[Object]\u001b[39m,",
                                "      sign: \u001b[36m[Object]\u001b[39m,",
                                "      retry: \u001b[36m[Object]\u001b[39m,",
                                "      afterRetry: \u001b[36m[Object]\u001b[39m,",
                                "      send: \u001b[36m[Object]\u001b[39m,",
                                "      validateResponse: \u001b[36m[Object]\u001b[39m,",
                                "      extractError: \u001b[36m[Object]\u001b[39m,",
                                "      extractData: \u001b[36m[Object]\u001b[39m,",
                                "      restart: \u001b[36m[Object]\u001b[39m,",
                                "      success: \u001b[36m[Object]\u001b[39m,",
                                "      error: \u001b[36m[Object]\u001b[39m,",
                                "      complete: \u001b[36m[Object]\u001b[39m",
                                "    }",
                                "  },",
                                "  _haltHandlersOnError: \u001b[33mfalse\u001b[39m,",
                                "  _events: {",
                                "    validate: [",
                                "      \u001b[36m[Function (anonymous)]\u001b[39m,",
                                "      \u001b[36m[Function]\u001b[39m,",
                                "      \u001b[36m[Function: VALIDATE_REGION]\u001b[39m,",
                                "      \u001b[36m[Function: BUILD_IDEMPOTENCY_TOKENS]\u001b[39m,",
                                "      \u001b[36m[Function: VALIDATE_PARAMETERS]\u001b[39m",
                                "    ],",
                                "    afterBuild: [",
                                "      \u001b[36m[Function: COMPUTE_CHECKSUM]\u001b[39m,",
                                "      \u001b[36m[Function]\u001b[39m,",
                                "      \u001b[36m[Function: SET_CONTENT_LENGTH]\u001b[39m,",
                                "      \u001b[36m[Function: SET_HTTP_HOST]\u001b[39m",
                                "    ],",
                                "    restart: [",
                                "      \u001b[36m[Function: RESTART]\u001b[39m",
                                "    ],",
                                "    sign: [",
                                "      \u001b[36m[Function (anonymous)]\u001b[39m,",
                                "      \u001b[36m[Function]\u001b[39m,",
                                "      \u001b[36m[Function]\u001b[39m",
                                "    ],",
                                "    validateResponse: [",
                                "      \u001b[36m[Function: VALIDATE_RESPONSE]\u001b[39m,",
                                "      \u001b[36m[Function (anonymous)]\u001b[39m",
                                "    ],",
                                "    send: [",
                                "      \u001b[36m[Function]\u001b[39m",
                                "    ],",
                                "    httpHeaders: [",
                                "      \u001b[36m[Function: HTTP_HEADERS]\u001b[39m",
                                "    ],",
                                "    httpData: [",
                                "      \u001b[36m[Function: HTTP_DATA]\u001b[39m",
                                "    ],",
                                "    httpDone: [",
                                "      \u001b[36m[Function: HTTP_DONE]\u001b[39m",
                                "    ],",
                                "    retry: [",
                                "      \u001b[36m[Function: FINALIZE_ERROR]\u001b[39m,",
                                "      \u001b[36m[Function: INVALIDATE_CREDENTIALS]\u001b[39m,",
                                "      \u001b[36m[Function: EXPIRED_SIGNATURE]\u001b[39m,",
                                "      \u001b[36m[Function: CLOCK_SKEWED]\u001b[39m,",
                                "      \u001b[36m[Function: REDIRECT]\u001b[39m,",
                                "      \u001b[36m[Function: RETRY_CHECK]\u001b[39m,",
                                "      \u001b[36m[Function: API_CALL_ATTEMPT_RETRY]\u001b[39m",
                                "    ],",
                                "    afterRetry: [",
                                "      \u001b[36m[Function]\u001b[39m",
                                "    ],",
                                "    build: [",
                                "      \u001b[36m[Function: buildRequest]\u001b[39m",
                                "    ],",
                                "    extractData: [",
                                "      \u001b[36m[Function: extractData]\u001b[39m,",
                                "      \u001b[36m[Function: extractRequestId]\u001b[39m",
                                "    ],",
                                "    extractError: [",
                                "      \u001b[36m[Function: extractError]\u001b[39m,",
                                "      \u001b[36m[Function: extractRequestId]\u001b[39m",
                                "    ],",
                                "    httpError: [",
                                "      \u001b[36m[Function: ENOTFOUND_ERROR]\u001b[39m",
                                "    ],",
                                "    success: [",
                                "      \u001b[36m[Function: API_CALL_ATTEMPT]\u001b[39m",
                                "    ],",
                                "    complete: [",
                                "      \u001b[36m[Function: API_CALL]\u001b[39m,",
                                "      \u001b[36m[Function (anonymous)]\u001b[39m",
                                "    ]",
                                "  },",
                                "  emit: \u001b[36m[Function: emit]\u001b[39m,",
                                "  API_CALL_ATTEMPT: \u001b[36m[Function: API_CALL_ATTEMPT]\u001b[39m,",
                                "  API_CALL_ATTEMPT_RETRY: \u001b[36m[Function: API_CALL_ATTEMPT_RETRY]\u001b[39m,",
                                "  API_CALL: \u001b[36m[Function: API_CALL]\u001b[39m,",
                                "  signedAt: \u001b[35m2022-03-14T14:28:52.069Z\u001b[39m",
                                "}"
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "null",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "javascript",
            "source": [
                "const { generateDestinations } = require('../ses');\n\nconst destinations = generateDestinations(all_emails)\n\nconsole.log(\"destinations\", JSON.stringify(destinations, null, 2))"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "destinations [",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"matthew.pirotte@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"matthew.pirotte@vumc.org\",",
                                "      \"recipient_firstname\": \"Matthew\",",
                                "      \"recipient_lastname\": \"Pirotte\",",
                                "      \"program_name\": \"Emergency Medicine\",",
                                "      \"total_evals\": 6,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Amanda\",",
                                "          \"trainee_lastname\": \"Whipple\",",
                                "          \"trainee_email\": \"amanda.barrett@vumc.org\",",
                                "          \"trainee_id\": \"8029a70e2d6814e2cc6c956f661d53bc\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Endotracheal Intubation\",",
                                "              \"procedure_id\": \"6938c24a-c8f5-4cb3-a5e1-61e0a3a174f9\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Femoral Arterial Catheter Placement\",",
                                "              \"procedure_id\": \"b2c5d1d7-69fc-4019-8a91-dff9538ddd7f\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Femoral Central Line Placement\",",
                                "              \"procedure_id\": \"3b085f91-07c6-4277-8a7b-a5ff6c9701b6\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        },",
                                "        {",
                                "          \"trainee_firstname\": \"Austin\",",
                                "          \"trainee_lastname\": \"Tipold\",",
                                "          \"trainee_email\": \"austin.tipold@vumc.org\",",
                                "          \"trainee_id\": \"d6070acf-6632-423f-82ac-6453c1068fef\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Conscious Sedation\",",
                                "              \"procedure_id\": \"979c680b-3ad4-4890-b584-c12e104ce00a\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 0",
                                "            }",
                                "          ]",
                                "        },",
                                "        {",
                                "          \"trainee_firstname\": \"Katherine\",",
                                "          \"trainee_lastname\": \"Rief\",",
                                "          \"trainee_email\": \"katherine.rief@vumc.org\",",
                                "          \"trainee_id\": \"be4975b7-d38c-483b-a2ba-58a0af013ea5\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Internal Jugular Central Line Placement (Ultrasound-Guided)\",",
                                "              \"procedure_id\": \"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Radial Arterial Line Placement\",",
                                "              \"procedure_id\": \"b93afc31-7357-4995-8fdd-2fe9aae853bb\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"sarah.b.sewell@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"sarah.b.sewell@vumc.org\",",
                                "      \"recipient_firstname\": \"Sarah\",",
                                "      \"recipient_lastname\": \"Sewell\",",
                                "      \"program_name\": \"Emergency Medicine\",",
                                "      \"total_evals\": 6,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Amanda\",",
                                "          \"trainee_lastname\": \"Whipple\",",
                                "          \"trainee_email\": \"amanda.barrett@vumc.org\",",
                                "          \"trainee_id\": \"8029a70e2d6814e2cc6c956f661d53bc\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Endotracheal Intubation\",",
                                "              \"procedure_id\": \"6938c24a-c8f5-4cb3-a5e1-61e0a3a174f9\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Femoral Arterial Catheter Placement\",",
                                "              \"procedure_id\": \"b2c5d1d7-69fc-4019-8a91-dff9538ddd7f\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Femoral Central Line Placement\",",
                                "              \"procedure_id\": \"3b085f91-07c6-4277-8a7b-a5ff6c9701b6\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        },",
                                "        {",
                                "          \"trainee_firstname\": \"Austin\",",
                                "          \"trainee_lastname\": \"Tipold\",",
                                "          \"trainee_email\": \"austin.tipold@vumc.org\",",
                                "          \"trainee_id\": \"d6070acf-6632-423f-82ac-6453c1068fef\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Conscious Sedation\",",
                                "              \"procedure_id\": \"979c680b-3ad4-4890-b584-c12e104ce00a\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 0",
                                "            }",
                                "          ]",
                                "        },",
                                "        {",
                                "          \"trainee_firstname\": \"Katherine\",",
                                "          \"trainee_lastname\": \"Rief\",",
                                "          \"trainee_email\": \"katherine.rief@vumc.org\",",
                                "          \"trainee_id\": \"be4975b7-d38c-483b-a2ba-58a0af013ea5\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Internal Jugular Central Line Placement (Ultrasound-Guided)\",",
                                "              \"procedure_id\": \"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Radial Arterial Line Placement\",",
                                "              \"procedure_id\": \"b93afc31-7357-4995-8fdd-2fe9aae853bb\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"tammy.tankersley@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"tammy.tankersley@vumc.org\",",
                                "      \"recipient_firstname\": \"Tammy\",",
                                "      \"recipient_lastname\": \"Tankersley\",",
                                "      \"program_name\": \"Emergency Medicine\",",
                                "      \"total_evals\": 6,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Amanda\",",
                                "          \"trainee_lastname\": \"Whipple\",",
                                "          \"trainee_email\": \"amanda.barrett@vumc.org\",",
                                "          \"trainee_id\": \"8029a70e2d6814e2cc6c956f661d53bc\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Endotracheal Intubation\",",
                                "              \"procedure_id\": \"6938c24a-c8f5-4cb3-a5e1-61e0a3a174f9\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Femoral Arterial Catheter Placement\",",
                                "              \"procedure_id\": \"b2c5d1d7-69fc-4019-8a91-dff9538ddd7f\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Femoral Central Line Placement\",",
                                "              \"procedure_id\": \"3b085f91-07c6-4277-8a7b-a5ff6c9701b6\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        },",
                                "        {",
                                "          \"trainee_firstname\": \"Austin\",",
                                "          \"trainee_lastname\": \"Tipold\",",
                                "          \"trainee_email\": \"austin.tipold@vumc.org\",",
                                "          \"trainee_id\": \"d6070acf-6632-423f-82ac-6453c1068fef\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Conscious Sedation\",",
                                "              \"procedure_id\": \"979c680b-3ad4-4890-b584-c12e104ce00a\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 0",
                                "            }",
                                "          ]",
                                "        },",
                                "        {",
                                "          \"trainee_firstname\": \"Katherine\",",
                                "          \"trainee_lastname\": \"Rief\",",
                                "          \"trainee_email\": \"katherine.rief@vumc.org\",",
                                "          \"trainee_id\": \"be4975b7-d38c-483b-a2ba-58a0af013ea5\",",
                                "          \"trainee_program\": \"Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Internal Jugular Central Line Placement (Ultrasound-Guided)\",",
                                "              \"procedure_id\": \"73d7dc13-83c6-4ff6-8022-35a3c55a4a95\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Radial Arterial Line Placement\",",
                                "              \"procedure_id\": \"b93afc31-7357-4995-8fdd-2fe9aae853bb\",",
                                "              \"to    },",
                                "            {",
                                "              \"procedure_name\": \"Remove Drain\",",
                                "              \"procedure_id\": \"f8dae571-e726-4cb8-a5ba-ea46cb5878ef\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Repair of Lacerations\",",
                                "              \"procedure_id\": \"f8ec9b8d-9cb1-4d74-8f6d-711a57f33dcd\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Revision Amputation\",",
                                "              \"procedure_id\": \"90588e1d-f4ae-4afb-afd0-033edcceda3b\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Skin Biopsy\",",
                                "              \"procedure_id\": \"de0d6193-7787-4911-a00c-2d6db2811c9b\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Staple and Suture Removal\",",
                                "              \"procedure_id\": \"d278b97a-550f-4eb2-8c6a-27f043248968\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Toe Amputation\",",
                                "              \"procedure_id\": \"747f53af-4b13-40c8-9828-28d27e8b1a25\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Traction Pin Removal\",",
                                "              \"procedure_id\": \"11cd10a8-b3a1-4e1a-86dc-86c6979afd4e\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Wound Irrigation and Debridement\",",
                                "              \"procedure_id\": \"ded9345a-ad45-454d-82b8-718af11e7828\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Wound Vac Change\",",
                                "              \"procedure_id\": \"dd125c30-149c-4720-b54d-13bbb216a3c9\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"daisy.a.ciener@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"daisy.a.ciener@vumc.org\",",
                                "      \"recipient_firstname\": \"Daisy\",",
                                "      \"recipient_lastname\": \"Ciener\",",
                                "      \"program_name\": \"Pediatric Emergency Medicine\",",
                                "      \"total_evals\": 1,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Blake\",",
                                "          \"trainee_lastname\": \"Gruenberg\",",
                                "          \"trainee_email\": \"blake.gruenberg@vumc.org\",",
                                "          \"trainee_id\": \"4584a8aa8942fdcdddb0bcea4b6b1096\",",
                                "          \"trainee_program\": \"Pediatric Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Lumbar Puncture\",",
                                "              \"procedure_id\": \"d0c4cdac-0747-4996-a819-76b0728f621b\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"rebekah.shaw@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"rebekah.shaw@vumc.org\",",
                                "      \"recipient_firstname\": \"Rebekah\",",
                                "      \"recipient_lastname\": \"Shaw\",",
                                "      \"program_name\": \"Pediatric Emergency Medicine\",",
                                "      \"total_evals\": 1,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Blake\",",
                                "          \"trainee_lastname\": \"Gruenberg\",",
                                "          \"trainee_email\": \"blake.gruenberg@vumc.org\",",
                                "          \"trainee_id\": \"4584a8aa8942fdcdddb0bcea4b6b1096\",",
                                "          \"trainee_program\": \"Pediatric Emergency Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Lumbar Puncture\",",
                                "              \"procedure_id\": \"d0c4cdac-0747-4996-a819-76b0728f621b\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"brooke.austin@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"brooke.austin@vumc.org\",",
                                "      \"recipient_firstname\": \"Brooke\",",
                                "      \"recipient_lastname\": \"Austin\",",
                                "      \"program_name\": \"Pediatrics\",",
                                "      \"total_evals\": 3,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Margaret\",",
                                "          \"trainee_lastname\": \"Barton\",",
                                "          \"trainee_email\": \"margaret.s.barton@vumc.org\",",
                                "          \"trainee_id\": \"321970eb3fe66c496f81f96830e7390e\",",
                                "          \"trainee_program\": \"Pediatrics\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Closure of Complex Laceration\",",
                                "              \"procedure_id\": \"e6f3f725-7742-4205-83fc-3d55124cc5f3\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Closure of Simple Laceration\",",
                                "              \"procedure_id\": \"3f35e028-d5da-4d57-af84-b4841f87f280\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 0",
                                "            },",
                                "            {",
                                "              \"procedure_name\": \"Lumbar Puncture\",",
                                "              \"procedure_id\": \"d0c4cdac-0747-4996-a819-76b0728f621b\",",
                                "              \"total_procs\": 1,",
                                "              \"practice_ready_procs\": 1",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"meredith.e.pugh@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"meredith.e.pugh@vumc.org\",",
                                "      \"recipient_firstname\": \"Meredith\",",
                                "      \"recipient_lastname\": \"Pugh\",",
                                "      \"program_name\": \"Pulmonary Disease and Critical Care Medicine\",",
                                "      \"total_evals\": 2,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Matthew\",",
                                "          \"trainee_lastname\": \"Christensen\",",
                                "          \"trainee_email\": \"matthew.christensen@vumc.org\",",
                                "          \"trainee_id\": \"1b28bf0e-26d6-4326-ad06-04642b353025\",",
                                "          \"trainee_program\": \"Pulmonary Disease and Critical Care Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Thoracentesis\",",
                                "              \"procedure_id\": \"d6d9ae4c-1964-4fc7-a469-7e39e192bf9c\",",
                                "              \"total_procs\": 2,",
                                "              \"practice_ready_procs\": 2",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  },",
                                "  {",
                                "    \"Destination\": {",
                                "      \"ToAddresses\": [",
                                "        \"michael.t.beasley@vumc.org\"",
                                "      ]",
                                "    },",
                                "    \"ReplacementTemplateData\": {",
                                "      \"recipient_email\": \"michael.t.beasley@vumc.org\",",
                                "      \"recipient_firstname\": \"Michael\",",
                                "      \"recipient_lastname\": \"Beasley\",",
                                "      \"program_name\": \"Pulmonary Disease and Critical Care Medicine\",",
                                "      \"total_evals\": 2,",
                                "      \"two_weeks_ago\": \"2/28/2022\",",
                                "      \"trainees\": [",
                                "        {",
                                "          \"trainee_firstname\": \"Matthew\",",
                                "          \"trainee_lastname\": \"Christensen\",",
                                "          \"trainee_email\": \"matthew.christensen@vumc.org\",",
                                "          \"trainee_id\": \"1b28bf0e-26d6-4326-ad06-04642b353025\",",
                                "          \"trainee_program\": \"Pulmonary Disease and Critical Care Medicine\",",
                                "          \"procedures\": [",
                                "            {",
                                "              \"procedure_name\": \"Thoracentesis\",",
                                "              \"procedure_id\": \"d6d9ae4c-1964-4fc7-a469-7e39e192bf9c\",",
                                "              \"total_procs\": 2,",
                                "              \"practice_ready_procs\": 2",
                                "            }",
                                "          ]",
                                "        }",
                                "      ]",
                                "    }",
                                "  }",
                                "]",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "javascript",
            "source": [
                "const { generateSesCalls } = require('../ses');\n\nconst ses_calls = generateSesCalls(destinations)\n\nconsole.log(\"ses_calls: \", ses_calls)"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "ses_calls:  [",
                                "  {",
                                "    Source: 'admin@simpl-bedside.org',",
                                "    Template: 'TestTemplate',",
                                "    Destinations: [",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object],",
                                "      [Object], [Object], [Object]",
                                "    ]",
                                "  }",
                                "]",
                                ""
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}